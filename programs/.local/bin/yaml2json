#!/usr/bin/env python3

import argparse
import json
import sys
from dataclasses import dataclass
from typing import TextIO

try:
    import yaml
except ImportError:
    print("Error: PyYAML is required", file=sys.stderr)
    sys.exit(1)


@dataclass
class Args:
    input: TextIO
    output: TextIO
    indent: int | None
    compact: bool


def main():
    parser = argparse.ArgumentParser(
        description="Convert YAML to JSON",
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""\
Examples:
  yaml2json config.yaml
  yaml2json config.yaml -o config.json
  cat config.yaml | yaml2json
  yaml2json config.yaml --indent 4""",
    )
    parser.add_argument(
        "input",
        nargs="?",
        type=argparse.FileType("r"),
        default=sys.stdin,
        help="input YAML file (default: stdin)",
    )
    parser.add_argument(
        "-o",
        "--output",
        type=argparse.FileType("w"),
        default=sys.stdout,
        help="output JSON file (default: stdout)",
    )
    parser.add_argument(
        "-i",
        "--indent",
        type=int,
        default=None,
        help="indentation level for pretty printing",
    )
    parser.add_argument(
        "-c",
        "--compact",
        action="store_true",
        help="compact output (no extra whitespace)",
    )

    args = Args(**vars(parser.parse_args()))

    try:
        data = yaml.safe_load(args.input)
    except yaml.YAMLError as e:
        print(f"Error parsing YAML: {e}", file=sys.stderr)
        sys.exit(1)

    separators = (",", ":") if args.compact else None
    json.dump(data, args.output, indent=args.indent, separators=separators)

    if args.output == sys.stdout:
        print()


if __name__ == "__main__":
    main()
